/*! (C) 2022 Conviva, Inc. All rights reserved. Confidential and proprietary. */
!function(o,e){"function"==typeof define&&define.amd?define(e):("object"==typeof exports||"object"==typeof module&&module.exports)&&(module.exports=e()),void 0!==o&&o&&(void 0!==o.Conviva&&o.Conviva?o.Conviva.AdProxyMonitor||o.ConvivaModuleLoading||(e=e(),o.ConvivaModuleLoading=!0,o.Conviva.AdProxyMonitor=e.AdProxyMonitor,o.Conviva.Impl.GoogleImaProxy=e.Impl.GoogleImaProxy,delete o.ConvivaModuleLoading):o.ConvivaModule)}(this,function(){var n={};return function(){"use strict";function o(o,e,g,t){var l=this;l.isAdBreakEnabled=!0,l.convivaAdAnalytics=null,l.isPreviousEventAdBuffering=!1,this.registerAdsLoaderListeners=function(){var o={};if(o[t.Constants.FRAMEWORK_NAME]="Google IMA SDK","undefined"==typeof google||!google)throw new Error("Google IMA SDK is not accessible");o[t.Constants.FRAMEWORK_VERSION]=""+google.ima.VERSION,l.convivaAdAnalytics.setAdPlayerInfo(o),l.adsLoader&&(l.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,l.adsManagerLoaded,!1),l.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,l.onAdsLoaderError,!1))},this.registerAdsManagerListeners=function(){l.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,l.onAdsManagerError,!1);var o,e=[google.ima.AdEvent.Type.AD_BREAK_READY,google.ima.AdEvent.Type.AD_CAN_PLAY,google.ima.AdEvent.Type.AD_METADATA,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,google.ima.AdEvent.Type.DURATION_CHANGE,google.ima.AdEvent.Type.EXPANDED_CHANGED,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.IMPRESSION,google.ima.AdEvent.Type.INTERACTION,google.ima.AdEvent.Type.LINEAR_CHANGED,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.LOG,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.RESUMED,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,google.ima.AdEvent.Type.SKIPPED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.THIRD_QUARTILE,google.ima.AdEvent.Type.USER_CLOSE,google.ima.AdEvent.Type.VIEWABLE_IMPRESSION,google.ima.AdEvent.Type.VOLUME_CHANGED,google.ima.AdEvent.Type.VOLUME_MUTED,google.ima.AdError.Type.AD_LOAD,google.ima.AdError.Type.AD_PLAY,google.ima.AdEvent.Type.AD_BUFFERING,google.ima.AdEvent.Type.AD_PROGRESS];for(o in e)l.adsManager.addEventListener(e[o],l.onAdEvent,!1)},this.adsManagerLoaded=function(o){l.adsManager=o.getAdsManager(l.adManagerInfo[t.Constants.IMASDK_CONTENT_PLAYER]),l.registerAdsManagerListeners()},this.onContentPauseRequested=function(o){l.allAdsCompleted=!1,l.contentPauseRequested=!0,l.convivaAdAnalytics&&(l.currentPodIndex=o.getAd().getAdPodInfo().getPodIndex(),l.isAdBreakEnabled&&(l.podDuration=o.getAd().getAdPodInfo().getMaxDuration(),0===l.currentPodIndex?l.podPosition="Pre-roll":-1===l.currentPodIndex?l.podPosition="Post-roll":l.podPosition="Mid-roll",(o={})[t.Constants.POD_POSITION]=l.podPosition,o[t.Constants.POD_DURATION]=l.podDuration,o[t.Constants.POD_INDEX]=l.podIndex,l.convivaAdAnalytics.reportAdBreakStarted(t.Constants.AdType.CLIENT_SIDE,t.Constants.AdPlayer.CONTENT,o),l.podStartSent=!0))},this.onContentResumeRequested=function(){l.allAdsCompleted=!1,l.convivaAdAnalytics&&l.isAdBreakEnabled&&l.podStartSent&&(l.convivaAdAnalytics.reportAdBreakEnded(),l.podStartSent=!1,l.podIndex++,l.podPosition=null),l.contentPauseRequested=!1},this.onAdEvent=function(o){o.type===google.ima.AdEvent.Type.LOADED&&o.getAd().isLinear()&&!l.adManagerInfo[t.Constants.AD_PRELOAD_FEATURE]?(l.onAdStart(o),l.convivaAdAnalytics.reportAdMetric(t.Constants.Playback.PLAYER_STATE,t.Constants.PlayerState.BUFFERING)):o.type===google.ima.AdEvent.Type.STARTED&&o.getAd().isLinear()?l.onAdStart(o):o.type===google.ima.AdEvent.Type.RESUMED&&o.getAd().isLinear()?l.convivaAdAnalytics&&l.convivaAdAnalytics.reportAdMetric(t.Constants.Playback.PLAYER_STATE,t.Constants.PlayerState.PLAYING):o.type===google.ima.AdEvent.Type.PAUSED&&!0===o.getAd().isLinear()?l.convivaAdAnalytics&&l.convivaAdAnalytics.reportAdMetric(t.Constants.Playback.PLAYER_STATE,t.Constants.PlayerState.PAUSED):o.type===google.ima.AdEvent.Type.COMPLETE&&!0===o.getAd().isLinear()?l.convivaAdAnalytics&&(l.convivaAdAnalytics.reportAdMetric(t.Constants.Playback.PLAYER_STATE,t.Constants.PlayerState.STOPPED),l.convivaAdAnalytics.reportAdEnded()):o.type===google.ima.AdEvent.Type.SKIPPED&&!0===o.getAd().isLinear()?l.convivaAdAnalytics&&(l.convivaAdAnalytics.reportAdMetric(t.Constants.Playback.PLAYER_STATE,t.Constants.PlayerState.STOPPED),l.convivaAdAnalytics.reportAdSkipped()):o.type===google.ima.AdEvent.Type.ALL_ADS_COMPLETED?l.allAdsCompleted=!0:o.type===google.ima.AdEvent.Type.LOG?l.onAdLogError(o):o.type===google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED?l.onContentPauseRequested(o):o.type===google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED?l.onContentResumeRequested(o):o.type===google.ima.AdEvent.Type.AD_BUFFERING?l.convivaAdAnalytics&&(l.isPreviousEventAdBuffering=!0,l.convivaAdAnalytics.reportAdMetric(t.Constants.Playback.PLAYER_STATE,t.Constants.PlayerState.BUFFERING)):o.type===google.ima.AdEvent.Type.AD_PROGRESS&&l.convivaAdAnalytics&&(l.isPreviousEventAdBuffering?l.isPreviousEventAdBuffering=!1:l.convivaAdAnalytics.reportAdMetric(t.Constants.Playback.PLAYER_STATE,t.Constants.PlayerState.PLAYING))},this.onAdStart=function(o){var e;l.convivaAdAnalytics&&(e=l.getConvivaAdMetadata(o.getAd()),l.convivaAdAnalytics.reportAdStarted(e),l.convivaAdAnalytics.reportAdMetric(t.Constants.Playback.RESOLUTION,o.getAd().getVastMediaWidth(),o.getAd().getVastMediaHeight()),l.convivaAdAnalytics.reportAdMetric(t.Constants.Playback.BITRATE,o.getAd().getVastMediaBitrate()))},this.onAdsLoaderError=function(o){o=o.getError();l.reportAdFailed(o,"Ads Loader Error")},this.onAdsManagerError=function(o){o=o.getError();l.handleAdError(o)},this.onAdLogError=function(){},this.getConvivaAdMetadata=function(o){var e,g,l,n={},i=(n[t.Constants.MODULE_NAME]="Google IMA",n[t.Constants.MODULE_VERSION]="4.0.4",n[t.Constants.ASSET_NAME]=o.getTitle(),n[t.Constants.STREAM_URL]=o.getMediaUrl(),n[t.Constants.DURATION]=o.getDuration(),n[t.Constants.IS_LIVE]=t.Constants.StreamType.VOD,l=o.getWrapperAdIds()&&0!==o.getWrapperAdIds().length?(l=o.getWrapperAdIds().length,e=o.getWrapperAdSystems()[l-1],g=o.getWrapperAdIds()[l-1],o.getWrapperCreativeIds()[l-1]):(e=o.getAdSystem(),g=o.getAdId(),o.getCreativeId()),0===o.getAdPodInfo().getPodIndex()?"Pre-roll":-1===o.getAdPodInfo().getPodIndex()?"Post-roll":"Mid-roll");return n["c3.ad.id"]=""+o.getAdId(),n["c3.ad.creativeId"]=""+o.getCreativeId(),n["c3.ad.technology"]="Client Side",n["c3.ad.system"]=""+o.getAdSystem(),n["c3.ad.sequence"]=""+o.getAdPodInfo().getAdPosition(),n["c3.ad.mediaFileApiFramework"]=""+o.getApiFramework(),n["c3.ad.advertiser"]=""+o.getAdvertiserName(),n["c3.ad.position"]=i,n["c3.ad.adManagerName"]="Google IMA SDK",n["c3.ad.adManagerVersion"]=""+google.ima.VERSION,n["c3.ad.firstAdSystem"]=""+e,n["c3.ad.firstAdId"]=""+g,n["c3.ad.firstCreativeId"]=""+l,n["c3.ad.univAdIdReg"]=void 0===o.getUniversalAdIds()||0===o.getUniversalAdIds().length||0<o.getUniversalAdIds().length&&void 0===o.getUniversalAdIds()[0].getAdIdRegistry()||0<o.getUniversalAdIds().length&&"unknown"===o.getUniversalAdIds()[0].getAdIdRegistry()?"NA":""+o.getUniversalAdIds()[0].getAdIdRegistry(),n["c3.ad.univAdIdVal"]=void 0===o.getUniversalAdIds()||0===o.getUniversalAdIds().length||0<o.getUniversalAdIds().length&&void 0===o.getUniversalAdIds()[0].getAdIdValue()||0<o.getUniversalAdIds().length&&"unknown"===o.getUniversalAdIds()[0].getAdIdValue()?"NA":""+o.getUniversalAdIds()[0].getAdIdValue(),n},this.handleAdError=function(o){if(o)switch(o.getType()){case google.ima.AdError.Type.AD_PLAY:l.handleAdPlayError(o);break;case google.ima.AdError.Type.AD_LOAD:l.handleAdLoadError(o)}},this.handleAdPlayError=function(o){l.reportAdFailed(o,"Ad Play Error")},this.handleAdLoadError=function(o){l.reportAdFailed(o,"Ad Load Error")},this.reportAdFailed=function(o,e){var g={};g[t.Constants.ASSET_NAME]=e,g[t.Constants.IS_LIVE]=t.Constants.StreamType.VOD,g["c3.ad.technology"]="Client Side",g["c3.ad.adManagerName"]="Google IMA SDK",g["c3.ad.adManagerVersion"]=""+google.ima.VERSION,l.convivaAdAnalytics.reportAdFailed(function(o){var e;o.getType&&"function"==typeof o.getType&&o.getType()&&(e="Type: "+o.getType());o.getErrorCode&&"function"==typeof o.getErrorCode&&o.getErrorCode()&&(e?e+=", Code: "+o.getErrorCode():e="Code: "+o.getErrorCode());o.getMessage&&"function"==typeof o.getMessage&&o.getMessage()&&(e?e+=", Message: "+o.getMessage():e="Message: "+o.getMessage());e=e||(o.toString()||"Ad Request Failed");return e}(o),g)},l.adsLoader=o,l.adManagerInfo=e,l.adsManager=null,l.convivaAdAnalytics=g,l.podIndex=1,l.podPosition=null,l.registerAdsLoaderListeners(),l.currentPodIndex=0,this.cleanup=function(){l.adsLoader=null,l.adManagerInfo=null,l.adsManager=null}}n.AdProxyMonitor={o:null,release:function(){this.o&&this.o.cleanup()},initConvivaDropIn:function(o,e,g,l){if(o)return this.o=new n.Impl.GoogleImaProxy(o,e,g,l),this.o;throw new Error("No Ad Manager proxy initialized")}},void 0!==n&&(n.Impl=n.Impl||{},n.Impl.GoogleImaProxy=o)}(),n});